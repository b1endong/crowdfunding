import{r as de}from"./index-CCQ-jUte.js";import{B as l,s as h,k as m,t as he,L as pe,c as ye,i as F,S as W,n as S,p as w,b as ge,I as me,a as I,d as G,e as be}from"./index-DC_CUsqb.js";function we(e,t){const n=e.exec(t);return n==null?void 0:n.groups}const D=/^tuple(?<array>(\[(\d*)\])*)$/;function P(e){let t=e.type;if(D.test(e.type)&&"components"in e){t="(";const n=e.components.length;for(let r=0;r<n;r++){const i=e.components[r];t+=P(i),r<n-1&&(t+=", ")}const s=we(D,e.type);return t+=`)${(s==null?void 0:s.array)??""}`,P({...e,type:t})}return"indexed"in e&&e.indexed&&(t=`${t} indexed`),e.name?`${t} ${e.name}`:t}function A(e){let t="";const n=e.length;for(let s=0;s<n;s++){const r=e[s];t+=P(r),s!==n-1&&(t+=", ")}return t}function Se(e){var t;return e.type==="function"?`function ${e.name}(${A(e.inputs)})${e.stateMutability&&e.stateMutability!=="nonpayable"?` ${e.stateMutability}`:""}${(t=e.outputs)!=null&&t.length?` returns (${A(e.outputs)})`:""}`:e.type==="event"?`event ${e.name}(${A(e.inputs)})`:e.type==="error"?`error ${e.name}(${A(e.inputs)})`:e.type==="constructor"?`constructor(${A(e.inputs)})${e.stateMutability==="payable"?" payable":""}`:e.type==="fallback"?`fallback() external${e.stateMutability==="payable"?" payable":""}`:"receive() external payable"}function v(e,{includeName:t=!1}={}){if(e.type!=="function"&&e.type!=="event"&&e.type!=="error")throw new ve(e.type);return`${e.name}(${U(e.inputs,{includeName:t})})`}function U(e,{includeName:t=!1}={}){return e?e.map(n=>xe(n,{includeName:t})).join(t?", ":","):""}function xe(e,{includeName:t}){return e.type.startsWith("tuple")?`(${U(e.components,{includeName:t})})${e.type.slice(5)}`:e.type+(t&&e.name?` ${e.name}`:"")}class Ae extends l{constructor({expectedLength:t,givenLength:n,type:s}){super([`ABI encoding array length mismatch for type ${s}.`,`Expected length: ${t}`,`Given length: ${n}`].join(`
`),{name:"AbiEncodingArrayLengthMismatchError"})}}class Ee extends l{constructor({expectedSize:t,value:n}){super(`Size of bytes "${n}" (bytes${h(n)}) does not match expected size (bytes${t}).`,{name:"AbiEncodingBytesSizeMismatchError"})}}class Te extends l{constructor({expectedLength:t,givenLength:n}){super(["ABI encoding params/values length mismatch.",`Expected length (params): ${t}`,`Given length (values): ${n}`].join(`
`),{name:"AbiEncodingLengthMismatchError"})}}class N extends l{constructor(t,{docsPath:n}={}){super([`Function ${t?`"${t}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the function exists on it."].join(`
`),{docsPath:n,name:"AbiFunctionNotFoundError"})}}class $e extends l{constructor(t,n){super("Found ambiguous types in overloaded ABI items.",{metaMessages:[`\`${t.type}\` in \`${v(t.abiItem)}\`, and`,`\`${n.type}\` in \`${v(n.abiItem)}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."],name:"AbiItemAmbiguityError"})}}class Be extends l{constructor({expectedSize:t,givenSize:n}){super(`Expected bytes${t}, got bytes${n}.`,{name:"BytesSizeMismatchError"})}}class Ie extends l{constructor(t,{docsPath:n}){super([`Type "${t}" is not a valid encoding type.`,"Please provide a valid ABI type."].join(`
`),{docsPath:n,name:"InvalidAbiEncodingType"})}}class Pe extends l{constructor(t){super([`Value "${t}" is not a valid array.`].join(`
`),{name:"InvalidArrayError"})}}class ve extends l{constructor(t){super([`"${t}" is not a valid definition type.`,'Valid types: "function", "event", "error"'].join(`
`),{name:"InvalidDefinitionTypeError"})}}const _e=e=>m(he(e));function ke(e){return _e(e)}function Me(e){let t=!0,n="",s=0,r="",i=!1;for(let a=0;a<e.length;a++){const o=e[a];if(["(",")",","].includes(o)&&(t=!0),o==="("&&s++,o===")"&&s--,!!t){if(s===0){if(o===" "&&["event","function",""].includes(r))r="";else if(r+=o,o===")"){i=!0;break}continue}if(o===" "){e[a-1]!==","&&n!==","&&n!==",("&&(n="",t=!1);continue}r+=o,n+=o}}if(!i)throw new l("Unable to normalize signature.");return r}const Ce=e=>{const t=typeof e=="string"?e:Se(e);return Me(t)};function J(e){return ke(Ce(e))}const Re=J;class K extends l{constructor({address:t}){super(`Address "${t}" is invalid.`,{metaMessages:["- Address must be a hex value of 20 bytes (40 hex characters).","- Address must match its checksum counterpart."],name:"InvalidAddressError"})}}const He=/^0x[a-fA-F0-9]{40}$/,B=new pe(8192);function E(e,t){const{strict:n=!0}=t??{},s=`${e}.${n}`;if(B.has(s))return B.get(s);const r=He.test(e)?e.toLowerCase()===e?!0:n?ye(e)===e:!0:!1;return B.set(s,r),r}function b(e){return typeof e[0]=="string"?Q(e):Oe(e)}function Oe(e){let t=0;for(const r of e)t+=r.length;const n=new Uint8Array(t);let s=0;for(const r of e)n.set(r,s),s+=r.length;return n}function Q(e){return`0x${e.reduce((t,n)=>t+n.replace("0x",""),"")}`}function X(e,t,n,{strict:s}={}){return F(e,{strict:!1})?ze(e,t,n,{strict:s}):qe(e,t,n,{strict:s})}function Y(e,t){if(typeof t=="number"&&t>0&&t>h(e)-1)throw new W({offset:t,position:"start",size:h(e)})}function Z(e,t,n){if(typeof t=="number"&&typeof n=="number"&&h(e)!==n-t)throw new W({offset:n,position:"end",size:h(e)})}function qe(e,t,n,{strict:s}={}){Y(e,t);const r=e.slice(t,n);return s&&Z(r,t,n),r}function ze(e,t,n,{strict:s}={}){Y(e,t);const r=`0x${e.replace("0x","").slice((t??0)*2,(n??e.length)*2)}`;return s&&Z(r,t,n),r}const De=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,ee=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function C(e,t){if(e.length!==t.length)throw new Te({expectedLength:e.length,givenLength:t.length});const n=Ne({params:e,values:t}),s=H(n);return s.length===0?"0x":s}function Ne({params:e,values:t}){const n=[];for(let s=0;s<e.length;s++)n.push(R({param:e[s],value:t[s]}));return n}function R({param:e,value:t}){const n=Je(e.type);if(n){const[s,r]=n;return Ve(t,{length:s,param:{...e,type:r}})}if(e.type==="tuple")return Ue(t,{param:e});if(e.type==="address")return je(t);if(e.type==="bool")return Fe(t);if(e.type.startsWith("uint")||e.type.startsWith("int")){const s=e.type.startsWith("int"),[,,r="256"]=ee.exec(e.type)??[];return We(t,{signed:s,size:Number(r)})}if(e.type.startsWith("bytes"))return Le(t,{param:e});if(e.type==="string")return Ge(t);throw new Ie(e.type,{docsPath:"/docs/contract/encodeAbiParameters"})}function H(e){let t=0;for(let i=0;i<e.length;i++){const{dynamic:a,encoded:o}=e[i];a?t+=32:t+=h(o)}const n=[],s=[];let r=0;for(let i=0;i<e.length;i++){const{dynamic:a,encoded:o}=e[i];a?(n.push(S(t+r,{size:32})),s.push(o),r+=h(o)):n.push(o)}return b([...n,...s])}function je(e){if(!E(e))throw new K({address:e});return{dynamic:!1,encoded:w(e.toLowerCase())}}function Ve(e,{length:t,param:n}){const s=t===null;if(!Array.isArray(e))throw new Pe(e);if(!s&&e.length!==t)throw new Ae({expectedLength:t,givenLength:e.length,type:`${n.type}[${t}]`});let r=!1;const i=[];for(let a=0;a<e.length;a++){const o=R({param:n,value:e[a]});o.dynamic&&(r=!0),i.push(o)}if(s||r){const a=H(i);if(s){const o=S(i.length,{size:32});return{dynamic:!0,encoded:i.length>0?b([o,a]):o}}if(r)return{dynamic:!0,encoded:a}}return{dynamic:!1,encoded:b(i.map(({encoded:a})=>a))}}function Le(e,{param:t}){const[,n]=t.type.split("bytes"),s=h(e);if(!n){let r=e;return s%32!==0&&(r=w(r,{dir:"right",size:Math.ceil((e.length-2)/2/32)*32})),{dynamic:!0,encoded:b([w(S(s,{size:32})),r])}}if(s!==Number.parseInt(n))throw new Ee({expectedSize:Number.parseInt(n),value:e});return{dynamic:!1,encoded:w(e,{dir:"right"})}}function Fe(e){if(typeof e!="boolean")throw new l(`Invalid boolean value: "${e}" (type: ${typeof e}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:w(ge(e))}}function We(e,{signed:t,size:n=256}){if(typeof n=="number"){const s=2n**(BigInt(n)-(t?1n:0n))-1n,r=t?-s-1n:0n;if(e>s||e<r)throw new me({max:s.toString(),min:r.toString(),signed:t,size:n/8,value:e.toString()})}return{dynamic:!1,encoded:S(e,{size:32,signed:t})}}function Ge(e){const t=I(e),n=Math.ceil(h(t)/32),s=[];for(let r=0;r<n;r++)s.push(w(X(t,r*32,(r+1)*32),{dir:"right"}));return{dynamic:!0,encoded:b([w(S(h(t),{size:32})),...s])}}function Ue(e,{param:t}){let n=!1;const s=[];for(let r=0;r<t.components.length;r++){const i=t.components[r],a=Array.isArray(e)?r:i.name,o=R({param:i,value:e[a]});s.push(o),o.dynamic&&(n=!0)}return{dynamic:n,encoded:n?H(s):b(s.map(({encoded:r})=>r))}}function Je(e){const t=e.match(/^(.*)\[(\d+)?\]$/);return t?[t[2]?Number(t[2]):null,t[1]]:void 0}const te=e=>X(J(e),0,4);function Ke(e){const{abi:t,args:n=[],name:s}=e,r=F(s,{strict:!1}),i=t.filter(o=>r?o.type==="function"?te(o)===s:o.type==="event"?Re(o)===s:!1:"name"in o&&o.name===s);if(i.length===0)return;if(i.length===1)return i[0];let a;for(const o of i){if(!("inputs"in o))continue;if(!n||n.length===0){if(!o.inputs||o.inputs.length===0)return o;continue}if(!o.inputs||o.inputs.length===0||o.inputs.length!==n.length)continue;if(n.every((y,p)=>{const d="inputs"in o&&o.inputs[p];return d?_(y,d):!1})){if(a&&"inputs"in a&&a.inputs){const y=ne(o.inputs,a.inputs,n);if(y)throw new $e({abiItem:o,type:y[0]},{abiItem:a,type:y[1]})}a=o}}return a||i[0]}function _(e,t){const n=typeof e,s=t.type;switch(s){case"address":return E(e,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return s==="tuple"&&"components"in t?Object.values(t.components).every((r,i)=>_(Object.values(e)[i],r)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(s)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(s)?n==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(s)?Array.isArray(e)&&e.every(r=>_(r,{...t,type:s.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function ne(e,t,n){for(const s in e){const r=e[s],i=t[s];if(r.type==="tuple"&&i.type==="tuple"&&"components"in r&&"components"in i)return ne(r.components,i.components,n[s]);const a=[r.type,i.type];if(a.includes("address")&&a.includes("bytes20")?!0:a.includes("address")&&a.includes("string")?E(n[s],{strict:!1}):a.includes("address")&&a.includes("bytes")?E(n[s],{strict:!1}):!1)return a}}const j="/docs/contract/encodeFunctionData";function Qe(e){const{abi:t,args:n,functionName:s}=e;let r=t[0];if(s){const i=Ke({abi:t,args:n,name:s});if(!i)throw new N(s,{docsPath:j});r=i}if(r.type!=="function")throw new N(void 0,{docsPath:j});return{abi:[r],functionName:te(v(r))}}function V(e){const{args:t}=e,{abi:n,functionName:s}=(()=>{var o;return e.abi.length===1&&((o=e.functionName)!=null&&o.startsWith("0x"))?e:Qe(e)})(),r=n[0],i=s,a="inputs"in r&&r.inputs?C(r.inputs,t??[]):void 0;return Q([i,a??"0x"])}const Xe=(e,t,n)=>JSON.stringify(e,(s,r)=>typeof r=="bigint"?r.toString():r,n);class Ye extends l{constructor({domain:t}){super(`Invalid domain "${Xe(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]})}}class Ze extends l{constructor({primaryType:t,types:n}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(n))}\`.`,{docsPath:"/api/glossary/Errors#typeddatainvalidprimarytypeerror",metaMessages:["Check that the primary type is a key in `types`."]})}}class et extends l{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."],name:"InvalidStructTypeError"})}}function tt(e){const{domain:t={},message:n,primaryType:s}=e,r={EIP712Domain:ot({domain:t}),...e.types};it({domain:t,message:n,primaryType:s,types:r});const i=["0x1901"];return t&&i.push(nt({domain:t,types:r})),s!=="EIP712Domain"&&i.push(se({data:n,primaryType:s,types:r})),m(b(i))}function nt({domain:e,types:t}){return se({data:e,primaryType:"EIP712Domain",types:t})}function se({data:e,primaryType:t,types:n}){const s=re({data:e,primaryType:t,types:n});return m(s)}function re({data:e,primaryType:t,types:n}){const s=[{type:"bytes32"}],r=[st({primaryType:t,types:n})];for(const i of n[t]){const[a,o]=oe({types:n,name:i.name,type:i.type,value:e[i.name]});s.push(a),r.push(o)}return C(s,r)}function st({primaryType:e,types:t}){const n=G(rt({primaryType:e,types:t}));return m(n)}function rt({primaryType:e,types:t}){let n="";const s=ie({primaryType:e,types:t});s.delete(e);const r=[e,...Array.from(s).sort()];for(const i of r)n+=`${i}(${t[i].map(({name:a,type:o})=>`${o} ${a}`).join(",")})`;return n}function ie({primaryType:e,types:t},n=new Set){const s=e.match(/^\w*/u),r=s==null?void 0:s[0];if(n.has(r)||t[r]===void 0)return n;n.add(r);for(const i of t[r])ie({primaryType:i.type,types:t},n);return n}function oe({types:e,name:t,type:n,value:s}){if(e[n]!==void 0)return[{type:"bytes32"},m(re({data:s,primaryType:n,types:e}))];if(n==="bytes")return s=`0x${(s.length%2?"0":"")+s.slice(2)}`,[{type:"bytes32"},m(s)];if(n==="string")return[{type:"bytes32"},m(G(s))];if(n.lastIndexOf("]")===n.length-1){const r=n.slice(0,n.lastIndexOf("[")),i=s.map(a=>oe({name:t,type:r,types:e,value:a}));return[{type:"bytes32"},m(C(i.map(([a])=>a),i.map(([,a])=>a)))]}return[{type:n},s]}function it(e){const{domain:t,message:n,primaryType:s,types:r}=e,i=(a,o)=>{for(const f of a){const{name:y,type:p}=f,d=o[y],O=p.match(ee);if(O&&(typeof d=="number"||typeof d=="bigint")){const[le,x,fe]=O;S(d,{signed:x==="int",size:Number.parseInt(fe)/8})}if(p==="address"&&typeof d=="string"&&!E(d))throw new K({address:d});const q=p.match(De);if(q){const[le,x]=q;if(x&&h(d)!==Number.parseInt(x))throw new Be({expectedSize:Number.parseInt(x),givenSize:h(d)})}const z=r[p];z&&(at(p),i(z,d))}};if(r.EIP712Domain&&t){if(typeof t!="object")throw new Ye({domain:t});i(r.EIP712Domain,t)}if(s!=="EIP712Domain")if(r[s])i(r[s],n);else throw new Ze({primaryType:s,types:r})}function ot({domain:e}){return[typeof(e==null?void 0:e.name)=="string"&&{name:"name",type:"string"},(e==null?void 0:e.version)&&{name:"version",type:"string"},(typeof(e==null?void 0:e.chainId)=="number"||typeof(e==null?void 0:e.chainId)=="bigint")&&{name:"chainId",type:"uint256"},(e==null?void 0:e.verifyingContract)&&{name:"verifyingContract",type:"address"},(e==null?void 0:e.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}function at(e){if(e==="address"||e==="bool"||e==="string"||e.startsWith("bytes")||e.startsWith("uint")||e.startsWith("int"))throw new et({type:e})}const ct=`Ethereum Signed Message:
`;function ut(e){const t=typeof e=="string"?I(e):typeof e.raw=="string"?e.raw:be(e.raw),n=I(`${ct}${h(t)}`);return b([n,t])}function lt(e,t){return m(ut(e),t)}const ft=()=>"9.1.0",dt=e=>e.toString(16).padStart(2,"0"),ht=e=>{const t=new Uint8Array(e/2);return window.crypto.getRandomValues(t),Array.from(t,dt).join("")},pt=()=>typeof window<"u"?ht(10):new Date().getTime().toString(36);class ${}$.makeRequest=(e,t)=>({id:pt(),method:e,params:t,env:{sdkVersion:ft()}});$.makeResponse=(e,t,n)=>({id:e,success:!0,version:n,data:t});$.makeErrorResponse=(e,t,n)=>({id:e,success:!1,error:t,version:n});var c;(function(e){e.sendTransactions="sendTransactions",e.rpcCall="rpcCall",e.getChainInfo="getChainInfo",e.getSafeInfo="getSafeInfo",e.getTxBySafeTxHash="getTxBySafeTxHash",e.getSafeBalances="getSafeBalances",e.signMessage="signMessage",e.signTypedMessage="signTypedMessage",e.getEnvironmentInfo="getEnvironmentInfo",e.getOffChainSignature="getOffChainSignature",e.requestAddressBook="requestAddressBook",e.wallet_getPermissions="wallet_getPermissions",e.wallet_requestPermissions="wallet_requestPermissions"})(c||(c={}));var k;(function(e){e.requestAddressBook="requestAddressBook"})(k||(k={}));class yt{constructor(t=null,n=!1){this.allowedOrigins=null,this.callbacks=new Map,this.debugMode=!1,this.isServer=typeof window>"u",this.isValidMessage=({origin:s,data:r,source:i})=>{const a=!r,o=!this.isServer&&i===window.parent,f=typeof r.version<"u"&&parseInt(r.version.split(".")[0]),y=typeof f=="number"&&f>=1;let p=!0;return Array.isArray(this.allowedOrigins)&&(p=this.allowedOrigins.find(d=>d.test(s))!==void 0),!a&&o&&y&&p},this.logIncomingMessage=s=>{console.info(`Safe Apps SDK v1: A message was received from origin ${s.origin}. `,s.data)},this.onParentMessage=s=>{this.isValidMessage(s)&&(this.debugMode&&this.logIncomingMessage(s),this.handleIncomingMessage(s.data))},this.handleIncomingMessage=s=>{const{id:r}=s,i=this.callbacks.get(r);i&&(i(s),this.callbacks.delete(r))},this.send=(s,r)=>{const i=$.makeRequest(s,r);if(this.isServer)throw new Error("Window doesn't exist");return window.parent.postMessage(i,"*"),new Promise((a,o)=>{this.callbacks.set(i.id,f=>{if(!f.success){o(new Error(f.error));return}a(f)})})},this.allowedOrigins=t,this.debugMode=n,this.isServer||window.addEventListener("message",this.onParentMessage)}}const ae=e=>typeof e=="object"&&e!=null&&"domain"in e&&"types"in e&&"message"in e;de();class gt{constructor(t){this.communicator=t}async getBySafeTxHash(t){if(!t)throw new Error("Invalid safeTxHash");return(await this.communicator.send(c.getTxBySafeTxHash,{safeTxHash:t})).data}async signMessage(t){const n={message:t};return(await this.communicator.send(c.signMessage,n)).data}async signTypedMessage(t){if(!ae(t))throw new Error("Invalid typed data");return(await this.communicator.send(c.signTypedMessage,{typedData:t})).data}async send({txs:t,params:n}){if(!t||!t.length)throw new Error("No transactions were passed");const s={txs:t,params:n};return(await this.communicator.send(c.sendTransactions,s)).data}}const u={eth_call:"eth_call",eth_gasPrice:"eth_gasPrice",eth_getLogs:"eth_getLogs",eth_getBalance:"eth_getBalance",eth_getCode:"eth_getCode",eth_getBlockByHash:"eth_getBlockByHash",eth_getBlockByNumber:"eth_getBlockByNumber",eth_getStorageAt:"eth_getStorageAt",eth_getTransactionByHash:"eth_getTransactionByHash",eth_getTransactionReceipt:"eth_getTransactionReceipt",eth_getTransactionCount:"eth_getTransactionCount",eth_estimateGas:"eth_estimateGas",safe_setSettings:"safe_setSettings"},g={defaultBlockParam:(e="latest")=>e,returnFullTxObjectParam:(e=!1)=>e,blockNumberToHex:e=>Number.isInteger(e)?`0x${e.toString(16)}`:e};class mt{constructor(t){this.communicator=t,this.call=this.buildRequest({call:u.eth_call,formatters:[null,g.defaultBlockParam]}),this.getBalance=this.buildRequest({call:u.eth_getBalance,formatters:[null,g.defaultBlockParam]}),this.getCode=this.buildRequest({call:u.eth_getCode,formatters:[null,g.defaultBlockParam]}),this.getStorageAt=this.buildRequest({call:u.eth_getStorageAt,formatters:[null,g.blockNumberToHex,g.defaultBlockParam]}),this.getPastLogs=this.buildRequest({call:u.eth_getLogs}),this.getBlockByHash=this.buildRequest({call:u.eth_getBlockByHash,formatters:[null,g.returnFullTxObjectParam]}),this.getBlockByNumber=this.buildRequest({call:u.eth_getBlockByNumber,formatters:[g.blockNumberToHex,g.returnFullTxObjectParam]}),this.getTransactionByHash=this.buildRequest({call:u.eth_getTransactionByHash}),this.getTransactionReceipt=this.buildRequest({call:u.eth_getTransactionReceipt}),this.getTransactionCount=this.buildRequest({call:u.eth_getTransactionCount,formatters:[null,g.defaultBlockParam]}),this.getGasPrice=this.buildRequest({call:u.eth_gasPrice}),this.getEstimateGas=n=>this.buildRequest({call:u.eth_estimateGas})([n]),this.setSafeSettings=this.buildRequest({call:u.safe_setSettings})}buildRequest(t){const{call:n,formatters:s}=t;return async r=>{s&&Array.isArray(r)&&s.forEach((o,f)=>{o&&(r[f]=o(r[f]))});const i={call:n,params:r||[]};return(await this.communicator.send(c.rpcCall,i)).data}}}const bt="0x1626ba7e",wt="0x20c13b0b",M=4001;class T extends Error{constructor(t,n,s){super(t),this.code=n,this.data=s,Object.setPrototypeOf(this,T.prototype)}}class ce{constructor(t){this.communicator=t}async getPermissions(){return(await this.communicator.send(c.wallet_getPermissions,void 0)).data}async requestPermissions(t){if(!this.isPermissionRequestValid(t))throw new T("Permissions request is invalid",M);try{return(await this.communicator.send(c.wallet_requestPermissions,t)).data}catch{throw new T("Permissions rejected",M)}}isPermissionRequestValid(t){return t.every(n=>typeof n=="object"?Object.keys(n).every(s=>!!Object.values(k).includes(s)):!1)}}const L=(e,t)=>t.some(n=>n.parentCapability===e),St=()=>(e,t,n)=>{const s=n.value;return n.value=async function(){const r=new ce(this.communicator);let i=await r.getPermissions();if(L(t,i)||(i=await r.requestPermissions([{[t]:{}}])),!L(t,i))throw new T("Permissions rejected",M);return s.apply(this)},n};var xt=function(e,t,n,s){var r=arguments.length,i=r<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,n):s,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r<3?a(i):r>3?a(t,n,i):a(t,n))||i);return r>3&&i&&Object.defineProperty(t,n,i),i};class ue{constructor(t){this.communicator=t}async getChainInfo(){return(await this.communicator.send(c.getChainInfo,void 0)).data}async getInfo(){return(await this.communicator.send(c.getSafeInfo,void 0)).data}async experimental_getBalances({currency:t="usd"}={}){return(await this.communicator.send(c.getSafeBalances,{currency:t})).data}async check1271Signature(t,n="0x"){const s=await this.getInfo(),r=V({abi:[{constant:!1,inputs:[{name:"_dataHash",type:"bytes32"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[t,n]}),i={call:u.eth_call,params:[{to:s.safeAddress,data:r},"latest"]};try{return(await this.communicator.send(c.rpcCall,i)).data.slice(0,10).toLowerCase()===bt}catch{return!1}}async check1271SignatureBytes(t,n="0x"){const s=await this.getInfo(),r=V({abi:[{constant:!1,inputs:[{name:"_data",type:"bytes"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[t,n]}),i={call:u.eth_call,params:[{to:s.safeAddress,data:r},"latest"]};try{return(await this.communicator.send(c.rpcCall,i)).data.slice(0,10).toLowerCase()===wt}catch{return!1}}calculateMessageHash(t){return lt(t)}calculateTypedMessageHash(t){const n=typeof t.domain.chainId=="object"?t.domain.chainId.toNumber():Number(t.domain.chainId);let s=t.primaryType;if(!s){const r=Object.values(t.types),i=Object.keys(t.types).filter(a=>r.every(o=>o.every(({type:f})=>f.replace("[","").replace("]","")!==a)));if(i.length===0||i.length>1)throw new Error("Please specify primaryType");s=i[0]}return tt({message:t.message,domain:{...t.domain,chainId:n,verifyingContract:t.domain.verifyingContract,salt:t.domain.salt},types:t.types,primaryType:s})}async getOffChainSignature(t){return(await this.communicator.send(c.getOffChainSignature,t)).data}async isMessageSigned(t,n="0x"){let s;if(typeof t=="string"&&(s=async()=>{const r=this.calculateMessageHash(t);return await this.isMessageHashSigned(r,n)}),ae(t)&&(s=async()=>{const r=this.calculateTypedMessageHash(t);return await this.isMessageHashSigned(r,n)}),s)return await s();throw new Error("Invalid message type")}async isMessageHashSigned(t,n="0x"){const s=[this.check1271Signature.bind(this),this.check1271SignatureBytes.bind(this)];for(const r of s)if(await r(t,n))return!0;return!1}async getEnvironmentInfo(){return(await this.communicator.send(c.getEnvironmentInfo,void 0)).data}async requestAddressBook(){return(await this.communicator.send(c.requestAddressBook,void 0)).data}}xt([St()],ue.prototype,"requestAddressBook",null);class Tt{constructor(t={}){const{allowedDomains:n=null,debug:s=!1}=t;this.communicator=new yt(n,s),this.eth=new mt(this.communicator),this.txs=new gt(this.communicator),this.safe=new ue(this.communicator),this.wallet=new ce(this.communicator)}}export{$ as MessageFormatter,c as Methods,u as RPC_CALLS,k as RestrictedMethods,Tt as default,ft as getSDKVersion,ae as isObjectEIP712TypedData};
